<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Grade System</title>

<style>
/* ---------- Layout หลัก ---------- */
.container {
  display: flex;
  flex-direction: column;
  gap: 15px;
  max-width: 600px;
  margin: auto;
  font-family: Arial, sans-serif;
}

/* ---------- แถว input ---------- */
.input-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.input-row label {
  width: 160px;
}

/* ---------- input ---------- */
input {
  width: 100%;
  padding: 10px;
  border: 2px solid #000;
  border-radius: 5px;
}

input:focus {
  background-color: #f0f8ff;
  border-color: #007bff;
  outline: none;
}

/* ---------- ปุ่ม ---------- */
.button-group {
  display: flex;
  justify-content: space-between;
}

#btn-calculate {
  background-color: #007bff;
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
}

#btn-clear {
  background-color: #6c757d;
  color: white;
  padding: 10px 15px;
  border: none;
  border-radius: 5px;
}

/* ---------- Result ---------- */
#result-container {
  display: none;
  background-color: #e6ffe6;
  border-left: 4px solid #006400;
  padding: 15px;
  border-radius: 8px;
}

/* ---------- Table ---------- */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

th, td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}
</style>
</head>

<body>

<div class="container">

  <!-- Input Fields -->
  <div class="input-row">
    <label>Student Name:</label>
    <input id="student-name" type="text">
  </div>

  <div class="input-row">
    <label>Subject:</label>
    <input id="subject-name" type="text">
  </div>

  <div class="input-row">
    <label>Midterm (20%):</label>
    <input id="midterm-score" type="text">
  </div>

  <div class="input-row">
    <label>Final (50%):</label>
    <input id="final-score" type="text">
  </div>

  <div class="input-row">
    <label>Assignment (30%):</label>
    <input id="assignment-score" type="text">
  </div>

  <!-- Buttons -->
  <div class="button-group">
    <button id="btn-calculate">Calculate Grade</button>
    <button id="btn-clear">Clear</button>
  </div>

  <!-- Result Section -->
  <div id="result-container">
    <p>Total Score: <span id="total-score">0</span></p>
    <p>Final Grade: <span id="final-grade">-</span></p>
    <p>Status: <span id="pass-status">-</span></p>
  </div>

  <!-- Grade History -->
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Subject</th>
        <th>Total Score</th>
        <th>Grade</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody id="history-body">
      <tr><td colspan="5">No data.</td></tr>
    </tbody>
  </table>

</div>

<script>
/* ---------- ตรวจสอบคะแนน ---------- */
function validateScore(score) {
  if (score === "") return false;               // ห้ามว่าง
  let num = Number(score);                      // แปลงเป็นตัวเลข
  if (isNaN(num)) return false;                 // ห้าม NaN
  return num >= 0 && num <= 100;                // ต้องอยู่ 0-100
}

/* ---------- คำนวณคะแนนรวม ---------- */
function calculateScore(midterm, final, assignment) {
  return (midterm * 0.2) + (final * 0.5) + (assignment * 0.3);
}

/* ---------- แปลงเป็นเกรด ---------- */
function getGrade(score) {
  if (score >= 80) return "A";
  if (score >= 70) return "B";
  if (score >= 60) return "C";
  if (score >= 50) return "D";
  return "F";
}

/* ---------- PASS / FAIL ---------- */
function getStatus(grade) {
  return grade === "F" ? "FAIL" : "PASS";
}

/* ---------- บันทึก localStorage ---------- */
function saveToStorage(data) {
  let stored = JSON.parse(localStorage.getItem("studentData")) || [];
  stored.push(data);
  localStorage.setItem("studentData", JSON.stringify(stored));
}

/* ---------- โหลด localStorage ---------- */
function loadFromStorage() {
  let data = localStorage.getItem("studentData");
  return data ? JSON.parse(data) : null;
}

/* ---------- แสดงตาราง ---------- */
function renderTable(data) {
  const body = document.getElementById("history-body");
  body.innerHTML = "";
  data.forEach(d => {
    body.innerHTML += `
      <tr>
        <td>${d.name}</td>
        <td>${d.subject}</td>
        <td>${d.score.toFixed(2)}</td>
        <td>${d.grade}</td>
        <td>${d.status}</td>
      </tr>`;
  });
}

/* ---------- Calculate ---------- */
function handleCalculate() {
  const name = document.getElementById("student-name").value.trim();
  const subject = document.getElementById("subject-name").value.trim();
  const mid = document.getElementById("midterm-score").value;
  const fin = document.getElementById("final-score").value;
  const ass = document.getElementById("assignment-score").value;

  if (!name || !subject) {
    alert("Please enter student name and subject");
    return;
  }

  if (!validateScore(mid) || !validateScore(fin) || !validateScore(ass)) {
    alert("All scores must be between 0-100");
    return;
  }

  const total = calculateScore(Number(mid), Number(fin), Number(ass));
  const grade = getGrade(total);
  const status = getStatus(grade);

  document.getElementById("total-score").textContent = total.toFixed(2);
  document.getElementById("final-grade").textContent = grade;
  document.getElementById("pass-status").textContent = status;
  document.getElementById("result-container").style.display = "block";

  const data = {
    name, subject,
    midterm: Number(mid),
    final: Number(fin),
    assignment: Number(ass),
    score: total,
    grade, status
  };

  saveToStorage(data);
  renderTable(loadFromStorage());
}

/* ---------- Clear ---------- */
function handleClear() {
  document.getElementById("student-name").value = "";
  document.getElementById("subject-name").value = "";
  document.getElementById("midterm-score").value = "";
  document.getElementById("final-score").value = "";
  document.getElementById("assignment-score").value = "";
  document.getElementById("result-container").style.display = "none";
}

/* ---------- Page Load ---------- */
window.addEventListener("DOMContentLoaded", () => {
  const data = loadFromStorage();
  if (data) renderTable(data);
});

/* ---------- Event Listener ---------- */
document.getElementById("btn-calculate").addEventListener("click", handleCalculate);
document.getElementById("btn-clear").addEventListener("click", handleClear);
</script>

</body>
</html>