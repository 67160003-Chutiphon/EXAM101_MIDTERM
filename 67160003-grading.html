<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Student Grade System</title>
    <style>
      /* CSS ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö: Flex layout, input style, focus state, button group, result box */
      body {
        font-family: sans-serif;
        padding: 20px;
        background: #fff;
      }

      .container {
        max-width: 600px;
        margin: 0 auto;
        border: 1px solid #000;
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      h3 {
        text-align: center;
        border-bottom: 1px solid #000;
        padding-bottom: 10px;
        margin: 0;
      }

      h4 {
        margin-top: 10px;
        margin-bottom: 10px;
        border-bottom: 1px solid #ccc;
        padding-bottom: 5px;
      }

      /* Flex row for label + input */
      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .row label {
        font-weight: bold;
      }

      /* Inputs: border 2px, padding 10px, radius 5px */
      input {
        padding: 10px;
        border: 2px solid #000;
        border-radius: 5px;
      }

      /* Focus state */
      input:focus {
        outline: none;
        background-color: #ffffcc;
        border-color: #0066ff;
      }

      .score-item::before {
        content: "";
        position: absolute;
        left: 0;
        top: 50%;
        width: 10px;
        height: 2px;
        background: #000;
      }

      .score-item:last-child {
        margin-bottom: 0;
      }

      /* Button group */
      .btn-group {
        display: flex;
        justify-content: space-between;
        gap: 10px;
      }

      button {
        flex: 1;
        padding: 10px;
        cursor: pointer;
        font-weight: bold;
        border: none;
        border-radius: 5px;
      }

      /* Primary (Calculate) - ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
      #btn-calculate {
        background: blue;
        color: white;
      }

      /* Secondary (Clear) - ‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
      #btn-clear {
        background: grey;
        color: white;
      }

      button:hover {
        opacity: 0.9;
      }

      /* Result box - ‡∏ã‡πà‡∏≠‡∏ô‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏£‡∏¥‡πà‡∏° */
      #result-container {
        display: none;
        background: #fff9e6;
        padding: 15px;
        border-left: 4px solid #ffaa00;
        border-radius: 8px;
        margin-top: 15px;
      }

      /* History Table */
      #history-section {
        margin-top: 20px;
        padding-top: 15px;
        border-top: 2px solid #000;
      }

      #results-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      #results-table th,
      #results-table td {
        border: 1px solid #000;
        padding: 8px;
        text-align: left;
      }

      #results-table th {
        background-color: #f0f0f0;
        font-weight: bold;
      }

      #results-table tbody tr:hover {
        background-color: #f9f9f9;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h3>STUDENT GRADE SYSTEM</h3>

      <div class="row">
        <label for="student-name">Student Name:</label>
        <input type="text" id="student-name" />
      </div>

      <div class="row">
        <label for="subject-name">Subject:</label>
        <input type="text" id="subject-name" />
      </div>

      <p><strong>Scores (out of 100):</strong></p>

      <div class="scores-area">
        <div class="score-item">
          <label for="midterm-score">Midterm (20%):</label>&nbsp;
          <input type="text" id="midterm-score" /> /100
        </div>

        <div class="score-item">
          <label for="final-score">Final (50%):</label>&nbsp;
          <input type="text" id="final-score" /> /100
        </div>

        <div class="score-item">
          <label for="assignment-score">Assignment (30%):</label>&nbsp;
          <input type="text" id="assignment-score" /> /100
        </div>
      </div>

      <div class="btn-group">
        <!-- ‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô "Calculate Grade" ‡πÅ‡∏•‡∏∞ "Clear" -->
        <button id="btn-calculate">Calculate Grade</button>
        <button id="btn-clear">Clear</button>
      </div>

      <!-- Result Section (‡∏ã‡πà‡∏≠‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô) ‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå -->
      <div id="result-container" style="display: none;">
        <p><strong>‚úî LATEST RESULT</strong></p>
        <p>Total Score: <span id="total-score">0</span></p>
        <p>Final Grade: <span id="final-grade">-</span></p>
        <p>Status: <span id="pass-status">-</span></p>
      </div>

      <!-- Previous Results Table -->
      <div id="history-section">
        <h4>üìã Grade History</h4>
        <table id="results-table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Subject</th>
              <th>Total Score</th>
              <th>Grade</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="table-body">
            <tr>
              <td colspan="5" style="text-align: center;">No data.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <script>
      /* ==========================
         ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô validation ‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö
         ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡∏ô‡∏ï‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏™‡∏±‡πâ‡∏ô ‡πÜ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏á‡πà‡∏≤‡∏¢
         ========================== */

      // validateScore: ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ true ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡∏´‡∏£‡∏∑‡∏≠ string ‡∏ó‡∏µ‡πà‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏î‡πâ),
      // ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0-100 ‡πÅ‡∏•‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
      function validateScore(score) {
        // ‡∏ñ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏á -> false
        if (score === "" || score === null || typeof score === "undefined") return false;
        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç
        const n = Number(score);
        // ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô NaN, ‡πÄ‡∏õ‡πá‡∏ô finite, ‡πÅ‡∏•‡∏∞‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á 0-100
        return Number.isFinite(n) && n >= 0 && n <= 100;
      }

      // calculateScore: ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏≤‡∏°‡∏™‡∏π‡∏ï‡∏£ Midterm 20%, Final 50%, Assignment 30%
      function calculateScore(midterm, final, assignment) {
        // ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ú‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö string
        const m = Number(midterm);
        const f = Number(final);
        const a = Number(assignment);
        return m * 0.2 + f * 0.5 + a * 0.3;
      }

      // getGrade: ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤ A-F ‡∏ï‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô
      function getGrade(score) {
        if (score >= 80) return "A";
        if (score >= 70) return "B";
        if (score >= 60) return "C";
        if (score >= 50) return "D";
        return "F";
      }

      // getStatus: ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏£‡∏î F => FAIL, else PASS
      function getStatus(grade) {
        return grade === "F" ? "FAIL" : "PASS";
      }

      // saveToStorage: ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏á localStorage ‡πÄ‡∏õ‡πá‡∏ô array ‡∏Ç‡∏≠‡∏á object
      function saveToStorage(data) {
        let existingData = loadFromStorage();
        if (!existingData) existingData = [];
        existingData.push(data);
        localStorage.setItem("studentData", JSON.stringify(existingData));
      }

      // loadFromStorage: ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ return null
      function loadFromStorage() {
        const data = localStorage.getItem("studentData");
        return data ? JSON.parse(data) : null;
      }

      // updateHistoryTable: ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å localStorage ‡∏•‡∏á‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
      function updateHistoryTable() {
        const tableBody = document.getElementById("table-body");
        const data = loadFromStorage();

        if (!data || data.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="5" style="text-align: center;">No data.</td></tr>';
          return;
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ñ‡∏ß‡∏à‡∏≤‡∏Å array (‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏°‡∏•‡∏≥‡∏î‡∏±‡∏ö‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å)
        tableBody.innerHTML = data
          .map(
            (item) => `
          <tr>
            <td>${escapeHtml(item.name)}</td>
            <td>${escapeHtml(item.subject)}</td>
            <td>${Number(item.score).toFixed(2)}</td>
            <td>${item.grade}</td>
            <td>${item.status}</td>
          </tr>
        `
          )
          .join("");
      }

      // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πá‡∏Å ‡πÜ ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô XSS (‡πÅ‡∏õ‡∏•‡∏á <, >, &)
      function escapeHtml(text) {
        if (typeof text !== "string") return text;
        return text.replaceAll("&", "&amp;").replaceAll("<", "&lt;").replaceAll(">", "&gt;");
      }

      // handleCalculate: ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏™‡∏≠‡∏ö (get values, validate, calculate, save, update)
      function handleCalculate() {
        const nameField = document.getElementById("student-name");
        const subjectField = document.getElementById("subject-name");
        const midField = document.getElementById("midterm-score");
        const finField = document.getElementById("final-score");
        const assField = document.getElementById("assignment-score");

        const name = nameField.value.trim();
        const subject = subjectField.value.trim();
        const midValue = midField.value;
        const finValue = finField.value;
        const assValue = assField.value;

        // 1) ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡∏∑‡πà‡∏≠‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ß‡πà‡∏≤‡∏á
        if (!name || !subject) {
          alert("Please enter student name and subject");
          return;
        }

        // 2) ‡∏ï‡∏£‡∏ß‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç (‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÑ‡∏î‡πâ)
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡πÅ‡∏à‡πâ‡∏á "Please enter valid numbers only"
        if (
          midValue === "" ||
          finValue === "" ||
          assValue === "" ||
          isNaN(Number(midValue)) ||
          isNaN(Number(finValue)) ||
          isNaN(Number(assValue))
        ) {
          alert("Please enter valid numbers only");
          return;
        }

        // 3) ‡∏ï‡∏£‡∏ß‡∏à‡∏ä‡πà‡∏ß‡∏á 0-100 ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ validateScore
        if (!validateScore(midValue) || !validateScore(finValue) || !validateScore(assValue)) {
          alert("All scores must be between 0-100");
          return;
        }

        // 4) ‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
        const midterm = Number(midValue);
        const final = Number(finValue);
        const assignment = Number(assValue);

        const score = calculateScore(midterm, final, assignment);
        const grade = getGrade(score);
        const status = getStatus(grade);

        // 5) ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÉ‡∏ô Result Section (‡∏ã‡πà‡∏≠‡∏ô->‡πÅ‡∏™‡∏î‡∏á)
        document.getElementById("total-score").textContent = score.toFixed(2);
        document.getElementById("final-grade").textContent = grade;
        document.getElementById("pass-status").textContent = status;
        document.getElementById("result-container").style.display = "block";

        // 6) ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° object ‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á localStorage
        const data = {
          name: name,
          subject: subject,
          midterm: midterm,
          final: final,
          assignment: assignment,
          score: score,
          grade: grade,
          status: status,
        };

        saveToStorage(data);
        updateHistoryTable();
      }

      // handleClear: ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå input ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡πÅ‡∏•‡∏∞‡∏ã‡πà‡∏≠‡∏ô result section
      function handleClear() {
        document.getElementById("student-name").value = "";
        document.getElementById("subject-name").value = "";
        document.getElementById("midterm-score").value = "";
        document.getElementById("final-score").value = "";
        document.getElementById("assignment-score").value = "";
        document.getElementById("result-container").style.display = "none";
      }

      // Auto-load ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö: bind event listeners ‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å storage
      window.addEventListener("DOMContentLoaded", () => {
        // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î event listeners (‡πÉ‡∏ä‡πâ addEventListener ‡∏ï‡∏≤‡∏°‡πÇ‡∏à‡∏ó‡∏¢‡πå)
        const btnCalculate = document.getElementById("btn-calculate");
        const btnClear = document.getElementById("btn-clear");

        btnCalculate.addEventListener("click", handleCalculate);
        btnClear.addEventListener("click", handleClear);

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡πÅ‡∏•‡∏∞‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        updateHistoryTable();
      });
    </script>
  </body>
</html>